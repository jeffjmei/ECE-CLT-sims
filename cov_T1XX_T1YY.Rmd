---
title: $Cov(T_1(X, X), T_1(Y, Y))$
date: 2024-12-17
tags: 
---

```{R, message=FALSE, warning=FALSE}
source("~/Documents/Research/Code/Simulations/CLT/clt_functions.R")
source("~/Documents/Research/Code/Simulations/CLT/parameters.R")
library(tidyverse)
library(MASS)
library(testthat)
```

# $Cov(T_1(X, X), T_1(Y, Y))$

```{R, warning=FALSE, message=FALSE}
sim_results <- map(1:10000, ~ {
  # Generate Data
  e <- mvrnorm(n, mu = c(0, 0), Sigma = S)
  ex <- e[, 1]
  ey <- e[, 2]

  list(
    hxhx_hyhy = Tk(hx, hx) * Tk(hy, hy),
    hxhx_hyey = Tk(hx, hx) * Tk(hy, ey),
    hxhx_eyey = Tk(hx, hx) * Tk(ey, ey),
    hxex_hyhy = Tk(hx, ex) * Tk(hy, hy),
    hxex_hyey = Tk(hx, ex) * Tk(hy, ey),
    hxex_eyey = Tk(hx, ex) * Tk(ey, ey),
    exex_hyhy = Tk(ex, ex) * Tk(hy, hy),
    exex_hyey = Tk(ex, ex) * Tk(hy, ey),
    exex_eyey = Tk(ex, ex) * Tk(ey, ey),
    total =
      Tk(hx, hx) * Tk(hy, hy) +
        2 * Tk(hx, hx) * Tk(hy, ey) +
        Tk(hx, hx) * Tk(ey, ey) +
        2 * Tk(hx, ex) * Tk(hy, hy) +
        4 * Tk(hx, ex) * Tk(hy, ey) +
        2 * Tk(hx, ex) * Tk(ey, ey) +
        Tk(ex, ex) * Tk(hy, hy) +
        2 * Tk(ex, ex) * Tk(hy, ey) +
        Tk(ex, ex) * Tk(ey, ey)
  )
})
hxhx_hyhy <- map_dbl(sim_results, "hxhx_hyhy") %>% conf_int()
hxhx_hyey <- map_dbl(sim_results, "hxhx_hyey") %>% conf_int()
hxhx_eyey <- map_dbl(sim_results, "hxhx_eyey") %>% conf_int()
hxex_hyhy <- map_dbl(sim_results, "hxex_hyhy") %>% conf_int()
hxex_hyey <- map_dbl(sim_results, "hxex_hyey") %>% conf_int()
hxex_eyey <- map_dbl(sim_results, "hxex_eyey") %>% conf_int()
exex_hyhy <- map_dbl(sim_results, "exex_hyhy") %>% conf_int()
exex_hyey <- map_dbl(sim_results, "exex_hyey") %>% conf_int()
exex_eyey <- map_dbl(sim_results, "exex_eyey") %>% conf_int()
total <- map_dbl(sim_results, "total") %>% conf_int()
```

## Theory
```{R, warning=FALSE, message=FALSE}
hxhx_hyhy_theory <- Tk(hx, hx) * Tk(hy, hy)
hxhx_hyey_theory <- 0
hxhx_eyey_theory <- Tk(hx, hx) * 2 * n * sy^2
hxex_hyhy_theory <- 0
hxex_hyey_theory <- 2 * sxy * Tk(hx, hy)
hxex_eyey_theory <- 0
exex_hyhy_theory <- Tk(hy, hy) * 2 * n * sx^2
exex_hyey_theory <- 0
exex_eyey_theory <- 4 * n^2 * sx^2 * sy^2
total_theory <- hxhx_hyhy_theory +
  2 * hxhx_hyey_theory +
  hxhx_eyey_theory +
  2 * hxex_hyhy_theory +
  4 * hxex_hyey_theory +
  2 * hxex_eyey_theory +
  exex_hyhy_theory +
  2 * exex_hyey_theory +
  exex_eyey_theory
```

## Unit Test
```{R, warning=FALSE, message=FALSE}
test_that("Cov(T1(X, X), T1(Y, Y))", {
  expect_true(
    (hxhx_hyhy_theory >= hxhx_hyhy[1]) &
      (hxhx_hyhy_theory <= hxhx_hyhy[2])
  )
  expect_true(
    (hxhx_hyey_theory >= hxhx_hyey[1]) &
      (hxhx_hyey_theory <= hxhx_hyey[2])
  )
  expect_true(
    (hxhx_eyey_theory >= hxhx_eyey[1]) &
      (hxhx_eyey_theory <= hxhx_eyey[2])
  )

  expect_true(
    (hxex_hyhy_theory >= hxex_hyhy[1]) &
      (hxex_hyhy_theory <= hxex_hyhy[2])
  )
  expect_true(
    (hxex_hyey_theory >= hxex_hyey[1]) &
      (hxex_hyey_theory <= hxex_hyey[2])
  )
  expect_true(
    (hxex_eyey_theory >= hxex_eyey[1]) &
      (hxex_eyey_theory <= hxex_eyey[2])
  )

  expect_true(
    (exex_hyhy_theory >= exex_hyhy[1]) &
      (exex_hyhy_theory <= exex_hyhy[2])
  )
  expect_true(
    (exex_hyey_theory >= exex_hyey[1]) &
      (exex_hyey_theory <= exex_hyey[2])
  )
  expect_true(
    (exex_eyey_theory >= exex_eyey[1]) &
      (exex_eyey_theory <= exex_eyey[2])
  )
  expect_true(
    (total_theory >= total[1]) &
      (total_theory <= total[2])
  )
})
```

